<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kitchen and aware Stores</title>
<style>
  body { font-family: Arial; text-align: center; }
  input, button { padding: 8px; margin: 5px; }
  .hidden { display: none; }
  .item { border: 1px solid #ccc; margin: 10px; padding: 10px; }
</style>
</head>
<body>

<!-- AUTH SECTION -->
<div id="authSection">
  <h2>Register / Login</h2>
  <input type="email" id="email" placeholder="Example@gmail.com"><br>
  <input type="password" id="password" placeholder="contain 0-9,@,a-z"><br>
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
</div>

<!-- SHOP SECTION -->
<div id="shopSection" class="hidden">
  <h2>Kitchen Items</h2>
  <div id="items"></div>
  <button onclick="showProfile()">My Profile</button>
  <button onclick="logout()">Logout</button>
</div>

<!-- PROFILE SECTION -->
<div id="profileSection" class="hidden">
  <h2>My Purchased Items</h2>
  <ul id="purchaseList"></ul>
  <button onclick="backToShop()">Back to Shop</button>
</div>

<script type="module">
/* ================= FIREBASE SETUP ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

import {
  getFirestore,
  collection,
  addDoc,
  query,
  where,
  getDocs
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBleGAurxkhHTqDPM96LdJ5c3sm9tBHggY",
  authDomain: "ummu-khalyl.firebaseapp.com",
  projectId: "ummu-khalyl",
  storageBucket: "ummu-khalyl.firebasestorage.app",
  messagingSenderId: "1074016415605",
  appId: "1:1074016415605:web:f1a9c857e87ba63dcced3c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ================= UI ELEMENTS ================= */
const authSection = document.getElementById("authSection");
const shopSection = document.getElementById("shopSection");
const profileSection = document.getElementById("profileSection");

/* ================= AUTH FUNCTIONS ================= */
window.register = function () {
  const email = emailInput();
  const password = passwordInput();

  createUserWithEmailAndPassword(auth, email, password)
    .then(() => alert("Registration successful press ok to contiue"))
    .catch(err => alert(err.message));
};

window.login = function () {
  const email = emailInput();
  const password = passwordInput();

  signInWithEmailAndPassword(auth, email, password)
    .catch(err => alert(err.message));
};

window.logout = function () {
  signOut(auth);
};

/* ================= SHOP ITEMS ================= */
const items = [
  { name: "Cooking Pot", price: 5000 },
  { name: "Frying Pan", price: 3500 },
  { name: "Knife Set", price: 2500 }
];

const itemsDiv = document.getElementById("items");

items.forEach(item => {
  const div = document.createElement("div");
  div.className = "item";
  div.innerHTML = `
    <p>${item.name} - ₦${item.price}</p>
    <button>Buy</button>
  `;
  div.querySelector("button").onclick = () => buyItem(item);
  itemsDiv.appendChild(div);
});

/* ================= BUY ITEM ================= */
function buyItem(item) {
  const user = auth.currentUser;
  if (!user) return alert("Please login");

  addDoc(collection(db, "purchases"), {
    uid: user.uid,
    name: item.name,
    price: item.price,
    date: new Date()
  });

  alert("Item saved to your profile");
}

/* ================= PROFILE ================= */
window.showProfile = async function () {
  shopSection.classList.add("hidden");
  profileSection.classList.remove("hidden");

  const list = document.getElementById("purchaseList");
  list.innerHTML = "";

  const user = auth.currentUser;
  const q = query(
    collection(db, "purchases"),
    where("uid", "==", user.uid)
  );

  const snapshot = await getDocs(q);
  snapshot.forEach(doc => {
    const li = document.createElement("li");
    li.textContent = `${doc.data().name} - ₦${doc.data().price}`;
    list.appendChild(li);
  });
};

window.backToShop = function () {
  profileSection.classList.add("hidden");
  shopSection.classList.remove("hidden");
};

/* ================= AUTH STATE ================= */
onAuthStateChanged(auth, user => {
  if (user) {
    authSection.classList.add("hidden");
    shopSection.classList.remove("hidden");
  } else {
    authSection.classList.remove("hidden");
    shopSection.classList.add("hidden");
    profileSection.classList.add("hidden");
  }
});

/* ================= HELPERS ================= */
function emailInput() {
  return document.getElementById("email").value;
}
function passwordInput() {
  return document.getElementById("password").value;
}
</script>

</body>
</html>
